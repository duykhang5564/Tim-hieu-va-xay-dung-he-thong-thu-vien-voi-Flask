{% extends "layout.html" %}
{% block content %}
<h4>Quản lý người dùng</h4>

<form action="{{ url_for('add_user') }}" method="POST" class="row g-2 mb-4">
    <div class="col"><input name="username" class="form-control" placeholder="Username" required></div>
    <div class="col"><input name="user_code" class="form-control" placeholder="Mã người dùng" required></div>
    <div class="col"><input name="password" type="password" class="form-control" placeholder="Mật khẩu" required></div>
    <div class="col"><input name="fullname" class="form-control" placeholder="Họ tên"></div>
    <div class="col"><input name="position" class="form-control" placeholder="Chức vụ"></div>
    <div class="col-auto">
        <input type="checkbox" name="is_admin"> Admin
    </div>
    <div class="col-auto">
        <button class="btn btn-success">Thêm</button>
    </div>
</form>

<table class="table table-striped align-middle">
    <thead class="table-dark">
        <tr>
            <th style="width: 25%">Username</th>
            <th style="width: 30%">Họ tên</th>
            <th style="width: 15%">Quyền</th>
            <th style="width: 15%">Chức vụ</th>
            <th style="width: 15%">Thao tác</th>
        </tr>
    </thead>
    <tbody>
        {% for u in users %}
        <tr>
            <td>{{ u.username }}</td>
            <td>{{ u.fullname }}</td>
            <td>{{ u.position }}</td>
            <td>
                {% if u.is_admin %}
                    <span class="badge bg-danger">Admin</span>
                {% else %}
                    <span class="badge bg-secondary">User</span>
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('edit_user_page', id=u.id) }}" class="btn btn-warning btn-sm">
                    <i class="bi bi-pencil-square"></i> Sửa
                </a> 
               <a href="{{ url_for('toggle_user', id=u.id) }}"
                    class="btn btn-sm {% if u.is_active %}btn-outline-danger{% else %}btn-outline-success{% endif %}"
                    onclick="return confirm('Xác nhận thao tác?')">
                    {% if u.is_active %}
                        <i class="bi bi-lock-fill"></i> Chặn
                    {% else %}
                        <i class="bi bi-unlock-fill"></i> Mở
                    {% endif %}
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
